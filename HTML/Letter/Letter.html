<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Lettre à ouvrir</title>
    <link href="Letter.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tu as une lettre à ouvrir !</h1>
            <p class="Dap">Veux-tu l'ouvrir ?</p>
        </div>
        <button class="ouiBtn">Oui</button>
        <button class="nonBtn">Non</button>
        <p class="boring"></p>
        <h3 class="Message"></h3>
        <input type="password" id="mdp" class="mdp">
        <button class="load">Entrer</button>
    </div>
    <canvas id="confetti"></canvas>
    <script>
        const ouiBtn = document.querySelector('.ouiBtn');
        const nonBtn = document.querySelector('.nonBtn');
        const container = document.querySelector('.container');
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        const title = document.querySelector('h1');
        const boring = document.querySelector('.boring');
        const load = document.querySelector('.load');
        const Dap = document.querySelector('.Dap');
        const scripted = "rN3byOHjgbnKMRXc19yNjNPThtvh483N0uGG2deO1d7K3NnS1+LV3s6O29OS3sbg0uKG0tfh1M3Q04afktLG3N7X2YXn3IHczuLP2ZLixtnZ4YbPmc/KjNsxD8be19QvEo4pBZLf1tHVjtbU29zVjN3d29mS4dDh29fYypIxCuDK19qF59yB3srn1dOS0sLa3I7TxpLY0OHb3CkO15qB4M6O3NTb4IHe0uDLkZLWxuHb09vY15qB0dzihtnh48vb3uDZhefcgc7Y3IbS4dvG2t2clJOSwtaM38/ZhTUY1d7OjtbK5OLW3ssxD8qS3sLeieLV2uaOxNHM14bJNRfU29UxD4Wvl4+al46pjNfh1YzL18vTkt7C3szThtbn04Hb147L2OaOzdGJn5qF2DEK4tvXy9eS39bRidjLheaVxtrf3c/KkjEIzZWO2c6SMQjNieHLhebg0OHf04bR04604JbEx9HX3NXV144pDubPyuCJ2suFo6OB1pDT1IXlz8rfidTPyNri09GJ4M/K4I6J1s6O2Mrl4saM3TEQ2deOxtqJ2o3G2+CKmomv1N7pz9rflY7a2pLe0OHb4MfYktuI0dfk1d7X4IHYzo7T1OaOpN7Y19nY09zVjNzXhtnnjsbfid7H1+jTz+HOjikFktrK3s6OycrV142MztyGyuXeJBXbz9TZkt/W0YkxDcaS3MaM3ZXHztfhgdzK4YbZ5N3RjM/Pz9mS0NbT0NPYk5K4xozd04bZ5N3W4s6O087Z3NDa19OShebT097S0NLK39PP4InS2Cgm2saMyuTLyJLjz4zP3djZktHC3srR2iga4MaM3eApDeWOwuDd19jG4OKNjNOVx87f04HOzs/byOHj0Yzd04bZ09/W1dfT2IWsjtTVidiNxuTgyuLOjikFkuLGjM/Pz9fXjtPV29OGyJnT1OCJ4Skg5NPO0dfihtbn04Hg3o7WxuXhxt+J49SF393O0dfihtbn14Hf2ODahdbTgdiQ3djJ29zC1dvThsnXjtXNidjV2uTcJBXOjsvZkt/W1Ynhx87mmoHczuPakjUY1d7OjtLGkuDG2s2O08rb2s3R3uDLk6Ccga/O4NrK5Y7L0Yney9rqjiQW3eDLhd7d1t7Njo7Z5DEJ34mW2tfh3oGU3+DHzt/TxtHX4obZ5N3RlZKXkoXfz8rfidGNyuXigdbK28fO5Y7R297ghtnXjsfN0uDLhdXWytHbjikFkt7T29ngy9LX3NWM2c/Y0dfgjYyslau4xo6xrbyOsqaSu6a1tbqrusSzga25vri0tbamjLOVq7OSsbC6vLO0uJ6Ozs3S4YbImdPU4InT1Mjh4MaM2d3b15LixozW09rZ5NOB0M7hhtXT183YzuLayuWagdDO4YbM4dvO0d3iy9iejsbgidLL2JIxCuDY19LK5Y7RzduOyc6S3sLeidopBZLSwtrcjtrGkuTK0ZeOsIw1F8Te0uGGKBnPgc3fz9TZktrCjNzdz9c1F8aMzNbL35K41tjS05KF4+PKjNzPz9mS2sKM3Nfa2tPiytvXjtbK5+KBz9HP1MzX4I2MyuPaxuDigdHXjsjU4I7S4ZDT1IXfz9biytfZkZLT1YzT04bRmdPU3CwW2MqS08+My93UkZLRydHjjrDa3tfGjNPThsvX4MLVidPUheXd0+DOjsrKktzGjNnP2YXU3crezpqGydeOw9XO3IbS147E29be1dfm09OMkdLbhd/dytrcjtbG5Y7HzdLgy4Xe04HP2NyPkZLQ09HPjtzU29okDInYy4Xoz8rfiTEP29vixt6J0suF5pXG2csxENnX4IHQzo7X2tfaxNvX39vKktvC2tIxDtfXnI+aicHb15LRxpiJ2seF2dfIzYnQ2M7j48aM3JXH1+QxC+DOjs/I25qB0d2O1dOS3tDh2+DHhdXdz+DS3NvK5I7E0d3iy4Xa19Tg2NfYypLewt6J28vY5c/I0YmPhrDT4NDh3Y7HheTPz4zK0Y3N09zQ4d0=";

        let nonleft = true;

        let nonhappened = 0;
        let nonend = false;
        let tries = 0;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let confettis = [];
        function createConfettis() {
            for (let i = 0; i < 150; i++) {
                confettis.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 6 + 4,
                    speed: Math.random() * 3 + 2,
                    color: `hsl(${Math.random() * 360}, 100%, 60%)`
                });
            }
        }

        function animateConfettis() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            confettis.forEach((c,i) => {
                c.y += c.speed;
                ctx.fillStyle = c.color;
                ctx.fillRect(c.x, c.y, c.size, c.size);

                if (c.y > canvas.height) {
                    confettis.splice(i, 1);
                }
            });
            if (confettis.length > 0) {
                requestAnimationFrame(animateConfettis);
            }
        }

        function ouiClicked() {
            title.style.transition = "none";
            if (boring.textContent !== "") {
                boring.textContent = "Merci ! =D";
            }
            ouiBtn.style.opacity = "0";
            ouiBtn.disabled = true;
            ouiBtn.style.cursor = "default";
            nonBtn.style.opacity = "0";
            nonBtn.disabled = true;
            nonBtn.style.cursor = "default";
            title.style.opacity = "0";
            Dap.textContent = "Veuillez entrer le mot de passe.";
            document.getElementById("mdp").style.opacity = "1";
            document.getElementById("mdp").style.pointerEvents = "auto";
            load.style.pointerEvents = "auto";
            document.querySelector(".Message").textContent = scripted;
            document.querySelector(".Message").style.color = "#black";
            document.querySelector(".Message").style.transform = 'none';
            void title.offsetWidth;
            document.querySelector(".Message").style.transition = "opacity 3s ease";
            document.querySelector(".Message").style.opacity = "1";
            load.style.opacity = "1";
            createConfettis();
            animateConfettis();
            document.body.classList.add("yesPressed");
        }

        nonBtn.style.left = '60%';
        nonBtn.style.top = '60%';
        nonBtn.style.transform = 'translate(-50%, -50%)';

        nonBtn.addEventListener('mouseenter', () => {
            if (tries === 51) {
                boring.textContent = "Ou pas. (Sitoplé clique Oui)";
                if (nonleft) {
                    nonBtn.style.left = "40%";
                    ouiBtn.style.left = "60%";
                    nonleft = false;
                } else {
                    nonBtn.style.left = "60%";
                    ouiBtn.style.left = "40%";
                    nonleft = true;
                }
                tries ++;
            } else if (tries > 51 && tries <= 65) {
                if (nonleft) {
                    nonBtn.style.left = "40%";
                    ouiBtn.style.left = "60%";
                    nonleft = false;
                } else {
                    nonBtn.style.left = "60%";
                    ouiBtn.style.left = "40%";
                    nonleft = true;
                }
                tries ++;
            } else if (tries > 65) {
                nonBtn.textContent = "Oui";
                nonBtn.style.backgroundColor = "green";
                nonBtn.disabled = false;
            }
            if (nonend) {
                nonBtn.style.transform = 'none';
                const maxX = container.clientWidth - nonBtn.offsetWidth;
                const maxY = container.clientHeight - nonBtn.offsetHeight;
                nonBtn.style.left = Math.random() * maxX + 'px';
                nonBtn.style.top = Math.random() * maxY + 'px';
                if (tries === 10) {
                    boring.textContent = "Tu es fatiguante...";
                    boring.style.opacity = '0';
                    boring.style.transition = "none";
                } else if (tries === 20) {
                    boring.textContent = "Juste clique sur Oui ;-;";
                    boring.style.opacity = '0';
                    boring.style.transition = "none";
                    boring.style.color = "deepskyblue";
                } else if (tries === 30) {
                    boring.textContent = "Bon OK tu as le droit de cliquer...";
                    boring.style.color = "black";
                    nonBtn.disabled = false;
                    nonend = false;
                } else if (tries === 31) {
                    boring.textContent = "ET TU CONTINUES !";
                    boring.style.opacity = '0';
                    boring.style.transition = "none";
                } else if (tries === 40) {
                    boring.textContent = "STOOOOP !";
                    boring.style.opacity = '0';
                    boring.style.transition = "none";
                } else if (tries === 50) {
                    boring.textContent = "Tu as gagné...";
                    nonBtn.disabled = true;
                    boring.style.color = "black";
                    nonend = false;
                    nonBtn.style.left = '60%';
                    nonBtn.style.top = '60%';
                    nonBtn.style.transform = 'translate(-50%, -50%)';
                }
                void boring.offsetWidth;
                boring.style.transition = "opacity 3s ease";
                boring.style.opacity = '1';
                tries ++;
            }
        });

        nonBtn.addEventListener('click', () => {
            nonhappened ++;
            if (nonhappened === 1) {
                ouiBtn.style.opacity = "0";
                ouiBtn.disabled = true;
                document.body.style.backgroundColor = '#000';
                title.textContent = "Ce n'était pas sensé arriver.";
                title.style.color = "red";
                nonBtn.style.left = '50%';
                nonBtn.textContent = "Ok ?";
                title.style.opacity = '0';
                title.style.transition = "none";
            } else if (nonhappened === 2) {
                title.textContent = 'Tu casses la tête, tu peux plus toucher "Non", toc...';
                nonBtn.textContent = "T'es infernal";
                title.style.opacity = '0';
                title.style.transition = "none";
            } else if (nonhappened === 3) {
                ouiBtn.style.opacity = "1";
                ouiBtn.disabled = false;
                nonBtn.disabled = true;
                nonBtn.style.color = "black";
                document.body.style.backgroundColor = "#FFF";
                title.textContent = "Tu as une lettre à ouvrir !"
                title.style.color = "black";
                nonBtn.style.left = "60%";
                nonBtn.textContent = "Non";
                nonend = true;
            } else {
                boring.textContent = "Tu as vraiment cru ? Naïve...";
                nonBtn.disabled = true;
                nonBtn.style.color = "black";
                nonend = true;
                nonBtn.style.transform = 'none';
                const maxX = container.clientWidth - nonBtn.offsetWidth;
                const maxY = container.clientHeight - nonBtn.offsetHeight;
                nonBtn.style.left = Math.random() * maxX + 'px';
                nonBtn.style.top = Math.random() * maxY + 'px';
            }
            void title.offsetWidth;
            title.style.transition = "opacity 3s ease";
            title.style.opacity = '1';
            if (nonBtn.textContent === "Oui") {
                ouiClicked();
            }
        });

        ouiBtn.addEventListener('click', () => {
            ouiClicked();
        });

        function decrypt(crypted, mdp) {
            const dec = new TextDecoder();
            const enc = new TextEncoder();
            const bytes = Uint8Array.from(atob(crypted), c => c.charCodeAt(0));

            const key = enc.encode(mdp);
            let out = new Uint8Array(bytes.length);

            for (let i=0; i<bytes.length; i++) {
                out[i] = (bytes[i] - key[i % key.length] + 256) % 256;
            }
            return dec.decode(out);
        }

        load.addEventListener('click', () => {
            let mdp = document.getElementById("mdp").value;
            const clear = decrypt(scripted, mdp);
            document.querySelector(".Message").textContent = clear;
            createConfettis();
            animateConfettis();
        });
    </script>
</body>